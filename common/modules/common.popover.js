!function(n){"use strict";var e=n.module("common.popover",["common.extensions"]);e.directive("popover",["$timeout","$animate","$parse","$browser",function(e,o,r,t){return{transclude:"element",restrict:"A",priority:500,terminal:!0,require:"?^popoverManager",compile:function(i,a,c){return function(i,a,p,u){function f(){A=i.$new(),c(A,function(n){w=n,o.enter(n,a.parent(),a),w.data("$popoverController",q),A.$popover=q})}function s(){w&&(o.leave(w),w=void 0),A&&(A.$destroy(),A=void 0)}var v=!0,l=null,$=function(){return p.popoverCloseDelay||0},g=p.popover||p.popoverManager;if(g)var d=r(g),m=d.assign;var h=function(){return g?d(i):u?u.opened:!1},y=function(n){if(g&&m(i,n),u&&u.change(n),n&&v&&(l&&(t.defer.cancel(l),l=null),v=!1,f()),!n&&!v&&!l){var e=$();e?l=t.defer(function(){h()||(v=!0,i.$$postDigest(function(){s()}),i.$digest()),l=null},e):(v=!0,i.$$postDigest(function(){s()}))}},M=function(e){if(h()){for(var o=n.element(e.target),r=!1;o.length&&!r;)r=o[0]==w[0],o=o.parent();r||i.$apply(function(){y(!1)})}},k=n.element(document.getElementsByTagName("body"));if(k.on("click",M),i.$on("$destroy",function(){k.off("click",M)}),u){var b=u.on("change",function(n){y(n)});i.$on("$destroy",b)}g&&i.$watch(g,function(n){y(n)});var w,A,q={close:function(){e(function(){y(!1)},0)},isVisible:function(){return!v}}}}}}]),e.directive("popoverHover",["$parse",function(n){return{restrict:"A",require:"?^popoverManager",link:function(e,o,r,t){var i=r.popover||r.popoverManager||r.popoverHover;if(i)var a=n(i),c=a.assign;var p=function(n){i&&c(e,n),t&&t.change(n)},u=function(){e.$apply(function(){p(!0)})},f=function(){e.$apply(function(){p(!1)})};o.on("mouseenter",u),o.on("mouseleave",f);var s=function(){o.off("mouseenter",u),o.off("mouseleave",f)};e.$on("$destroy",s)}}}]),e.directive("popoverManager",[function(){return{restrict:"A",controller:["$scope","$element","$attrs","$parse","EventEmitterFactory",function(n,e,o,r,t){t.apply(this);var i=o.popoverManager;if(i)var a=r(i),c=a.assign;this.opened=!1,this.change=function(e){Boolean(this.opened)!=Boolean(e)&&(this.opened=e,i&&c(n,this.opened),this.emit("change",this.opened))},i&&n.$watch(i,function(n){this.change(n)}.bind(this))}]}}]),e.directive("popoverOpen",["$parse","$browser",function(n,e){return{restrict:"A",require:"?^popoverManager",link:function(o,r,t,i){var a=t.popover||t.popoverManager||t.popoverOpen;if(a)var c=n(a),p=c.assign;var u=function(){return a?c(o):i?i.opened:!1},f=function(n){a&&p(o,n),i&&i.change(n)};r.on("click",function(){e.defer(function(){u()||o.$apply(function(){f(!0)})},0)})}}}]),e.directive("popoverToggle",["$parse","$browser",function(n,e){return{restrict:"A",require:"?^popoverManager",link:function(o,r,t,i){var a=t.popover||t.popoverManager||t.popoverToggle;if(a)var c=n(a),p=c.assign;var u=function(){return a?c(o):i?i.opened:!1},f=function(n){a&&p(o,n),i&&i.change(n)};r.on("click",function(){u()?o.$apply(function(){f(!1)}):e.defer(function(){o.$apply(function(){f(!0)})},0)})}}}])}(angular);